$(document).ready(function () {
    $(".header__burger").on("click" , function (){
        $(".menu").addClass("visible");
        $("body").addClass("overflow");
    })
    $(".menu__close").on("click" , function (){
        $(".menu").removeClass("visible");
        $("body").removeClass("overflow");

    })
    $(".menu__nav a").on("click" , function (){
        $("body").removeClass("overflow");
        setTimeout(()=>{
            $(".menu").removeClass("visible");
            let el = $(this).attr('href');
            $('html, body').animate({
                scrollTop: $(el).offset().top - 100
            });
        },150)
    })

    $(".thank__close").on("click" , function (){
        $(".thank").removeClass("visible");
        $("body").removeClass("overflow");
    })
    $(window).scroll(function (){
        let scrollTop = $(this).scrollTop();

        if(scrollTop >= 30){
            $('.header').addClass("white");
        }
        else{
            $('.header').removeClass("white");
        }
    })
})

$(document).ready(function () {

    if ($(window).width() < 600) {
        $('.jel__head:nth-child(2)').appendTo('.jel__center')
    }

    $(".datepicker").datepicker({
        dateFormat: "dd MM yy",
        changeMonth: true,
        changeYear: true,
        yearRange: "-20:+0",
        language: 'ua',
        showOn: "button",
        buttonText: "day",
        minDate: 0,
    });
    $.datepicker.regional['ua'] = {
        closeText: 'Закрити',
        prevText: '&#x3c;Поп',
        nextText: 'Наст&#x3e;',
        currentText: 'Сьогодні',
        monthNames: ['Января', 'Февраля', 'Марта', 'Апреля', 'Мая', 'Июня',
            'Июля', 'Августа', 'Сентября', 'Октября', 'Ноября', 'Декабря'],
        monthNamesShort: ['Лют', 'Січ', 'Бер', 'Квіт', 'Трав', 'Черв',
            'Лип', 'Серп', 'Вер', 'Жовт', 'Лист', 'Груд'],
        dayNames: ['неділя', 'понеділок', 'вівторок', 'среда', 'четвер', 'п\'ятница', 'субота'],
        dayNamesShort: ['нд', 'пн', 'вт', 'ср', 'чт', 'пт', 'сб'],
        dayNamesMin: ['Нд', 'Пн', 'Вт', 'Ср', 'Чт', 'Пт', 'Сб'],
        weekHeader: 'Ти',
        dateFormat: 'dd.mm.yy',
        firstDay: 1,
        isRTL: false,
        showMonthAfterYear: false,
        yearSuffix: ''
    };
    $.datepicker.setDefaults($.datepicker.regional['ua']);


    $('.fake').on('click', function (e) {
        $(this).parents('.form').find('.ui-datepicker-trigger').click();
    })


    let maskEmail = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/;
    $('.form .btn').on('click', function (e) {
        e.preventDefault();
        let valid = 0;
        let name = $(this).parents('.form').find('.nameinput');
        let email = $(this).parents('.form').find('.emailinput');
        let message = $(this).parents('.form').find('.messageinput');
        let anonim = $(this).parents('.form').find('.check');
        let date = $(this).parents('.form').find('.datepicker');
        let time = $(this).parents('.form').find('.timeinput');
        if (anonim.hasClass('active')) {
            valid++;
            name.removeClass('error');
        } else {
            if (name.val().length >= 3) {
                valid++;
                name.removeClass('error');
            } else {
                name.addClass('error');
            }
        }

        if (message.val().length >= 3) {
            valid++;
            message.removeClass('error');
        } else {
            message.addClass('error');
        }

        if (email.val().match(maskEmail)) {
            valid++;
            email.removeClass('error');
        } else {
            email.addClass('error');
        }
        if (date.val()) {
            valid++;
            date.removeClass('error');
        } else {
            date.addClass('error');
        }

        if (time.val()) {
            valid++;
            time.removeClass('error');
        } else {
            time.addClass('error');
        }

        if (valid == 5) {
            jQuery.ajax({
                type: 'POST',
                url: '/mail.php',
                data: {
                    name: name.val(),
                    email: email.val(),
                    message: message.val(),
                    date: date.val(),
                    anonim: anonim.hasClass('active') ? 'Анонимно' : '',
                    time: time.val(),
                },
                success: function (response) {
                    $(".thank").addClass("visible");
                    $("body").addClass("overflow");
                    return false;
                }
            })
        }

    })

    $('.form input').on('input', function (e) {
        $(this).removeClass('error');
    })

    $('.fake2').on('click', function (e) {
        e.preventDefault();
        $(this).parents('.form').find('.timeSelect').addClass('active');

    })


    $('.timeSelect').on('click', 'div', function (e) {
        e.preventDefault();
        let val = $(this).html();
        $('.timeSelect').removeClass('active');
        $(this).parents('.form').find('.timeinput').val(val);
        $(this).parents('.form').find('.timeinput').attr('value', val);
    })

    $('.form .check').on('click', function (e) {
        e.preventDefault();
        $(this).hasClass('active') ? $(this).removeClass('active') : $(this).addClass('active')
    })

    let coef = 2;
    if ($(window).width() < 992) {
        if ($(window).width() < 600) {
            coef = 0
        }else{
            coef = 1;
        }
    }
    $('.review__list svg.right').on('click', function (e) {
        e.preventDefault();
        let index = parseInt($('.review__nav').attr('data-active'));
        let elementWidth = parseInt($('.review__item').css('width').split('px')[0]) + parseInt($('.review__item').css('margin-right').split('px')[0]);
        if (index + 1 <= $('.review__item').length - coef) {
            $('.review__slider').css('transform', 'translateX(-' + (index * elementWidth) + 'px)');
            $('.review__nav').attr('data-active', index + 1);
            $('.review__nav>div').removeClass('active');
            $('.review__nav>div:nth-child(' + (index + 1) + ')').addClass('active');
        }
    })
    if ($(window).width() <= 600) {
        $('<div></div>').appendTo('.review__nav');
        $('<div></div>').appendTo('.review__nav');
    }

    $('.intro__button').on('click', function (e) {
        e.preventDefault();
        $('html, body').animate({
            scrollTop: $('.last').offset().top - 100
        });
    })

    $('.header__menu a, .footer__menu a').on('click', function (e) {
        let el = $(this).attr('href');
        $('.header__menu a').removeClass('active');
        $(this).addClass('active');
        e.preventDefault();
        $('html, body').animate({
            scrollTop: $(el).offset().top - 100
        });
    })
    let coef2 = 5;
    if ($(window).width() < 992) {
        if ($(window).width() < 600) {
            coef2 = 0
        }else{
            coef2 = 2;
        }
    }
    $('.review__list svg.left').on('click', function (e) {
        e.preventDefault();
        let index = parseInt($('.review__nav').attr('data-active'));
        let elementWidth = parseInt($('.review__item').css('width').split('px')[0]) + parseInt($('.review__item').css('margin-right').split('px')[0]);
        if (index - 1 >= 1) {
            $('.review__slider').css('transform', 'translateX(-' + ((index - 2) * elementWidth) + 'px)');
            $('.review__nav').attr('data-active', index - 1);
            $('.review__nav>div').removeClass('active');
            $('.review__nav>div:nth-child(' + (index - 1) + ')').addClass('active');
        }
    })


    $('.cert__list .right').on('click', function (e) {
        e.preventDefault();
        let index = parseInt($('.cert__slider').attr('data-active'));
        let elementWidth = parseInt($('.cert__slider>div').css('width').split('px')[0]) + parseInt($('.cert__slider>div').css('margin-right').split('px')[0]);
        if (index + 1 <= $('.cert__slider>div').length - coef2) {
            $('.cert__slider').css('transform', 'translateX(-' + (index * elementWidth) + 'px)');
            $('.cert__slider').attr('data-active', index + 1);
        }
    })


    $('.cert__list .left').on('click', function (e) {
        e.preventDefault();
        let index = parseInt($('.cert__slider').attr('data-active'));
        let elementWidth = parseInt($('.cert__slider>div').css('width').split('px')[0]) + parseInt($('.cert__slider>div').css('margin-right').split('px')[0]);
        if (index - 1 >= 1) {
            $('.cert__slider').css('transform', 'translateX(-' + ((index - 2) * elementWidth) + 'px)');
            $('.cert__slider').attr('data-active', index - 1);
        }
    })
})
